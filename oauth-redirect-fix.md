# 🚨 redirect_uri_mismatch エラーの修正手順

## エラーの詳細
```
エラー 400: redirect_uri_mismatch
リクエストの詳細: flowName=GeneralOAuthFlow
```

このエラーは、Google Cloud Consoleで設定されているリダイレクトURIと、アプリが送信しているリダイレクトURIが一致しないことが原因です。

## 📋 Step 1: 現在のアプリ設定を確認

アプリは以下のリダイレクトURIを使用しています：
```
com.googleusercontent.apps.478117704045-6b1tisa38ceqkpkl758mh2c9dl301ma0:/oauthredirect
```

## 🔧 Step 2: Google Cloud Consoleで確認・修正

### 1. Google Cloud Consoleにアクセス
https://console.cloud.google.com/

### 2. プロジェクトを選択
- 左上のプロジェクト名をクリック
- 正しいプロジェクトが選択されていることを確認

### 3. APIとサービスに移動
- 左メニュー > **APIとサービス** > **認証情報**

### 4. OAuth 2.0 クライアント IDを見つける
- **OAuth 2.0 クライアント ID** セクションを確認
- 名前が `478117704045-6b1tisa38ceqkpkl758mh2c9dl301ma0.apps.googleusercontent.com` のものをクリック

### 5. 設定画面で確認
以下の項目を確認してください：

#### アプリケーションの種類
```
✅ デスクトップアプリケーション
```

#### 承認済みのリダイレクトURI
**現在の設定を確認し、以下が含まれているか確認：**
```
com.googleusercontent.apps.478117704045-6b1tisa38ceqkpkl758mh2c9dl301ma0:/oauthredirect
```

### 6. 設定を修正

#### A. 承認済みのリダイレクトURIが空の場合
1. **+ URI を追加** をクリック
2. 以下を正確に入力：
   ```
   com.googleusercontent.apps.478117704045-6b1tisa38ceqkpkl758mh2c9dl301ma0:/oauthredirect
   ```
3. **保存** をクリック

#### B. 違うURIが設定されている場合
1. 既存のURIを削除またはする
2. 正しいURIを追加：
   ```
   com.googleusercontent.apps.478117704045-6b1tisa38ceqkpkl758mh2c9dl301ma0:/oauthredirect
   ```
3. **保存** をクリック

## 📸 スクリーンショットで確認する箇所

### 認証情報画面
```
OAuth 2.0 クライアント ID
┌─────────────────────────────────────────────────────┐
│ 名前: [Client名]                                      │
│ クライアント ID: 478117704045-6b1tisa...             │
│ クライアント シークレット: GOCSPX-...                │
│ 作成日: [日付]                                        │
│ [編集] [削除] [ダウンロード]                           │
└─────────────────────────────────────────────────────┘
```

### 設定詳細画面
```
OAuth 2.0 クライアント ID の編集
┌─────────────────────────────────────────────────────┐
│ アプリケーションの種類                                  │
│ ● デスクトップアプリケーション                          │
│                                                     │
│ 名前                                                │
│ [アプリ名]                                           │
│                                                     │
│ 承認済みのリダイレクト URI                            │
│ com.googleusercontent.apps.478117704045-...:/oauth... │
│ [+ URI を追加]                                       │
│                                                     │
│ [保存] [キャンセル]                                  │
└─────────────────────────────────────────────────────┘
```

## 🔍 Step 3: 詳細チェックリスト

以下をすべて確認してください：

- [ ] **プロジェクトが正しい** - Client IDが一致している
- [ ] **アプリケーションの種類** が「デスクトップアプリケーション」
- [ ] **リダイレクトURI** が正確（スペース、タイポなし）
- [ ] **保存** ボタンをクリックした
- [ ] **Calendar API** が有効化されている

## 🧪 Step 4: テスト

1. Google Cloud Consoleで設定を保存
2. 5-10分待つ（設定反映に時間がかかる場合があります）
3. アプリを完全に終了
4. アプリを再起動
5. 「Sign in with Google」をテスト

## 🆘 まだエラーが出る場合

### A. 設定の再確認
- Client IDをコピペして再度確認
- リダイレクトURIに隠れた文字がないか確認
- ブラウザのキャッシュをクリア

### B. 新しいOAuth認証情報を作成
1. **+ 認証情報を作成** > **OAuth クライアント ID**
2. **デスクトップアプリケーション** を選択
3. 名前を入力（例：FreeSlotExporter）
4. **作成** をクリック
5. 新しいClient IDとSecretを取得
6. アプリの設定を更新

### C. OAuth同意画面の確認
1. **OAuth同意画面** タブをクリック
2. **公開ステータス** が「テスト」の場合、**テストユーザー** に自分のGoogleアカウントを追加
3. または「本番環境に公開」を実行

## 💡 トラブルシューティングのコツ

- **正確性**: URIは1文字でも違うとエラーになります
- **大文字小文字**: 区別されるので注意
- **コピペ推奨**: 手入力ではなくコピー&ペーストを使用
- **反映時間**: 設定変更後、5-10分待つ

この手順で必ず解決できます！